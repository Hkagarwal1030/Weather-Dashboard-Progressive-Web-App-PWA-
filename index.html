<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Weather PWA</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="manifest" href="manifest.json">
  <style>/*...same linear-gradient & loader styles...*/</style>
</head>
<body class="bg-gradient">
<div class="card mx-auto mt-5" style="max-width:400px;">
  <div class="card-body text-center">
    <h4>ğŸŒ¤ï¸ Weather Checker</h4>
    <input type="text" id="city" class="form-control mb-3" placeholder="Enter city">
    <button id="btn-city" class="btn btn-primary w-100">Get Weather</button><br>
    <button id="btn-loc" class="btn btn-outline-secondary mt-2 w-100">Use My Location</button>
    <div id="loader" class="loader d-none"></div>
    <div id="weather" class="mt-4"></div>
    <div id="forecast" class="mt-4"></div>
  </div>
</div>
<script>
  if('serviceWorker' in navigator) navigator.serviceWorker.register('sw.js');
  
  document.getElementById('btn-city').onclick =()=>fetchWeather(document.getElementById('city').value);
  document.getElementById('btn-loc').onclick =()=>navigator.geolocation.getCurrentPosition(pos=>{
    fetchWeather(`${pos.coords.latitude},${pos.coords.longitude}`,true);
  },err=>alert('Location error'));

  function fetchWeather(q,isCoord=false) {
    const weatherDiv=document.getElementById('weather'), fDiv=document.getElementById('forecast'), loader=document.getElementById('loader');
    weatherDiv.innerHTML=fDiv.innerHTML=''; loader.classList.remove('d-none');
    const param = isCoord ? `lat=${q.split(',')[0]}&lon=${q.split(',')[1]}` : `city=${q}`;
    fetch(`backend.php?${param}`)
    .then(r=>r.json())
    .then(data=>{
       loader.classList.add('d-none');
       if(data.error) return weatherDiv.innerHTML=`<div class="alert alert-danger">${data.error}</div>`;
       weatherDiv.innerHTML=`
         <div class="p-3 bg-light rounded">
           <h5>${data.city}</h5>
           <p>Temp: ${data.current.temp}Â°C</p>
           <p>${data.current.desc}</p>
           <p>Humidity: ${data.current.humidity}%</p>
           <p>Wind: ${data.current.wind} km/h</p>
         </div>`;
       let html='<h5>5-Day Forecast</h5><div class="list-group">';
       data.forecast.forEach(f=>html+=`<div class="list-group-item">${f.dt}: ${f.temp}Â°C, ${f.desc}</div>`);
       fDiv.innerHTML=html+'</div>';
    }).catch(()=>loader.classList.add('d-none'), weatherDiv.innerHTML=`<div class="alert alert-danger">Something went wrong</div>`);
  }
</script>
</body>
</html>
